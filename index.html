<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Scratch Profile</title>
<style>
:root{
  --orange:#ff8c1a;
  --bg:#f7f7f7;
  --card:#fff;
  --border:#e0e0e0;
}
body{
  margin:0;
  background:var(--bg);
  font-family: Arial, Helvetica, sans-serif;
}
.header{
  background:var(--orange);
  height:120px;
}
.wrap{
  max-width:900px;
  margin:-60px auto 40px;
  padding:0 20px;
}
.profile{
  background:var(--card);
  border-radius:8px;
  padding:20px;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
}
.top{
  display:flex;
  gap:20px;
}
.icon{
  width:120px;
  height:120px;
  border-radius:8px;
  background:#ddd;
}
.name{
  font-size:26px;
  font-weight:bold;
}
.stats{
  margin-top:6px;
  font-size:14px;
  color:#555;
}
.tabs{
  display:flex;
  gap:20px;
  margin-top:25px;
  border-bottom:2px solid var(--border);
}
.tab{
  padding:8px 0;
  cursor:pointer;
  font-weight:bold;
}
.tab.active{
  border-bottom:3px solid var(--orange);
}
.list{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:15px;
  margin-top:20px;
}
.card{
  background:#fafafa;
  border:1px solid var(--border);
  border-radius:6px;
  padding:10px;
  font-size:14px;
}
.card img{
  width:100%;
  border-radius:4px;
}
.center{
  text-align:center;
  padding:30px;
  color:#666;
}
a{
  color:var(--orange);
  text-decoration:none;
  font-weight:bold;
}
</style>
</head>
<body>

<div class="header"></div>

<div class="wrap">
  <div class="profile">
    <div class="top">
      <img id="icon" class="icon">
      <div>
        <div class="name" id="name"></div>
        <div class="stats">
          „Éï„Ç©„É≠„ÉØ„Éº <span id="followers">-</span> /
          „Éï„Ç©„É≠„Éº <span id="following">-</span> /
          ‰ΩúÂìÅ <span id="projects">-</span>
        </div>
        <a id="link" target="_blank">Scratch„ÅßË¶ã„Çã</a>
      </div>
    </div>

    <div class="tabs">
      <div class="tab active" onclick="loadTab('projects',this)">„Éó„É≠„Ç∏„Çß„ÇØ„Éà</div>
      <div class="tab" onclick="loadTab('followers',this)">„Éï„Ç©„É≠„ÉØ„Éº</div>
      <div class="tab" onclick="loadTab('following',this)">„Éï„Ç©„É≠„Éº</div>
      <div class="tab" onclick="loadTab('studios',this)">„Çπ„Çø„Ç∏„Ç™</div>
    </div>

    <div id="content" class="center">Ë™≠„ÅøËæº„Åø‰∏≠‚Ä¶</div>
  </div>
</div>

<script>
const API_BASE = "https://p-d.f5.si";

const user = new URLSearchParams(location.search).get('users');
if(!user){
  document.getElementById('content').textContent =
    '?users=„É¶„Éº„Ç∂„ÉºÂêç „ÇíÊåáÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
  throw '';
}

/* ===== „Éó„É≠„Éï„Ç£„Éº„É´Âü∫Êú¨ÊÉÖÂ†± ===== */
fetch(`${API_BASE}/check.php?users=` + encodeURIComponent(user))
.then(r=>r.json())
.then(d=>{
  if(!d.found){
    document.getElementById('content').textContent =
      '„Åì„ÅÆ„É¶„Éº„Ç∂„Éº„ÅØ„Çπ„Çø„Ç∏„Ç™„Å´Âê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì';
    return;
  }

  document.getElementById('icon').src = d.profile.icon_200;
  document.getElementById('name').textContent = d.profile.username;
  document.getElementById('link').href = d.profile.profile_url;

  document.getElementById('followers').textContent = d.profile.followers;
  document.getElementById('following').textContent = d.profile.following;
  document.getElementById('projects').textContent  = d.profile.projects;
});

/* ===== „Çø„ÉñË°®Á§∫ ===== */
function loadTab(type, el){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');

  document.getElementById('content').textContent = 'Ë™≠„ÅøËæº„Åø‰∏≠‚Ä¶';

  fetch(`${API_BASE}/check_list.php?users=${encodeURIComponent(user)}&type=${type}&limit=20`)
    .then(r=>r.json())
    .then(d=>{
      if(!d.data || d.data.length === 0){
        document.getElementById('content').textContent = '„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì';
        return;
      }

      let html = '<div class="list">';
      d.data.forEach(x=>{
        if(type === 'projects'){
          html += `
            <div class="card">
              <img src="${x.image}">
              <b>${x.title}</b><br>
              ‚ù§Ô∏è ${x.loves}„ÄÄüëÅ ${x.views}
            </div>`;
        }

        if(type === 'followers' || type === 'following'){
          html += `
            <div class="card">
              <b>${x.username}</b><br>
              <a target="_blank"
                 href="https://scratch.mit.edu/users/${x.username}/">
                „Éó„É≠„Éï„Ç£„Éº„É´
              </a>
            </div>`;
        }

        if(type === 'studios'){
          html += `
            <div class="card">
              <img src="${x.image}">
              <b>${x.title}</b>
            </div>`;
        }
      });
      html += '</div>';

      document.getElementById('content').innerHTML = html;
    });
}

/* ÂàùÊúüË°®Á§∫ */
loadTab('projects', document.querySelector('.tab'));
</script>

</body>
</html>
